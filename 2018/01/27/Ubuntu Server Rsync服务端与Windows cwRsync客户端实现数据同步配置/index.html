
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Ubuntu Server Rsync服务端与Windows cwRsync客户端实现数据同步配置 | yangxc</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="perla">
    
    <meta name="description" content="Rsync(remote synchronize)是一个远程数据同步工具，可以使用“Rsync算法”同步本地和远程主机之间的文件。rsync的好处是只同步两个文件不同的部分，相同的部分不在传递。类似于增量备份，这使的在服务器传递备份文件或者同步文件，比起scp工具要省好多时间
一. 需要的工具下载c">
    
    
    
    
    <link rel="alternate" href="/atom.xml## RSS address." title="yangxc" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/catman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/catman.jpg">
    
    <link rel="stylesheet" type="text/css" href="http://cdn.bootcss.com/font-awesome/4.2.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/style.css">
    


<script type="text/javascript">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

    <link href='http://fonts.useso.com/css?family=Tangerine:700' rel='stylesheet' type='text/css'>
<link href='http://fonts.useso.com/css?family=Covered+By+Your+Grace' rel='stylesheet' type='text/css'>
<link href='http://fonts.useso.com/css?family=Philosopher' rel='stylesheet' type='text/css'>
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="yangxc" title="yangxc"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="yangxc">yangxc</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
					<li>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/01/27/Ubuntu Server Rsync服务端与Windows cwRsync客户端实现数据同步配置/" title="Ubuntu Server Rsync服务端与Windows cwRsync客户端实现数据同步配置" itemprop="url">Ubuntu Server Rsync服务端与Windows cwRsync客户端实现数据同步配置</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://yoursite.com" title="perla">perla</a>
    </p>
  <p class="article-time">
    <time datetime="2018-01-27T06:00:00.000Z" itemprop="datePublished">2018-01-27</time>
    更新日期:<time datetime="2018-03-05T08:07:47.322Z" itemprop="dateModified">2018-03-05</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#一-需要的工具"><span class="toc-number">1.</span> <span class="toc-text">一. 需要的工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#二-服务器端"><span class="toc-number">2.</span> <span class="toc-text">二. 服务器端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#三-客户端"><span class="toc-number">3.</span> <span class="toc-text">三. 客户端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#四-同步文件"><span class="toc-number">4.</span> <span class="toc-text">四. 同步文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#五-Rsync命令详解"><span class="toc-number">5.</span> <span class="toc-text">五. Rsync命令详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#六-部分错误的解决办法"><span class="toc-number">6.</span> <span class="toc-text">六. 部分错误的解决办法</span></a></li></ol>
		</div>
		
		<p>Rsync(remote synchronize)是一个远程数据同步工具，可以使用“Rsync算法”同步本地和远程主机之间的文件。rsync的好处是只同步两个文件不同的部分，相同的部分不在传递。类似于增量备份，这使的在服务器传递备份文件或者同步文件，比起scp工具要省好多时间</p>
<h3 id="一-需要的工具"><a href="#一-需要的工具" class="headerlink" title="一. 需要的工具"></a>一. 需要的工具</h3><p>下载cwRsyncServer服务器端与客户端的安装文件：</p>
<p>服务端下载：<a href="https://pan.baidu.com/share/link?shareid=901516432&amp;uk=118355419" title="服务端下载" target="_blank" rel="noopener">cwRsyncServer_4.0.5_Installer.zip</a></p>
<p>客户端下载：<a href="https://pan.baidu.com/share/link?shareid=903891290&amp;uk=118355419" target="_blank" rel="noopener">cwRsync_4.0.5_Installer.zip</a></p>
<p>server:111.111.111.111</p>
<p>client:192.168.7.20</p>
<h3 id="二-服务器端"><a href="#二-服务器端" class="headerlink" title="二. 服务器端"></a>二. 服务器端</h3><ol>
<li><p>ubuntu server 默认已安装rsync，但是rsync服务默认不是启动的，我们要修改下面的文件$sudo vi /etc/default/rsync<br>RSYNC_ENABLE=false    #false改true</p>
</li>
<li><p>修改配置文件/etc/rsyncd.conf</p>
</li>
</ol>
<p>我们先来查看一下这个文件<br>$sudo cat /etc/rsyncd.conf</p>
<blockquote>
<p> #sample rsyncd.conf configuration file</p>
<p>#GLOBAL OPTIONS</p>
<p>#motd file=/etc/motd #登录欢迎信息</p>
<p>#log file=/var/log/rsyncd #日志文件</p>
<p>#for pid file, do not use &gt;/var/run/rsync.pid if</p>
<p>#you are going to run rsync out of the init.d script.<br>pid file=/var/run/rsyncd.pid #进程编号</p>
<p>#指定rsync发送日志消息给syslog时的消息级别，常见的消息级别是：uth, authpriv, cron, daemon, ftp, kern, lpr, mail, news, security, sys-log, user, uucp, local0, local1, local2, local3,local4, local5, local6和local7。默认值是daemon。</p>
<p>#syslog facility=daemon #执行系统日志记录活动</p>
<p>#自定义tcp选项，默认是关闭的</p>
<p>#socket options=</p>
<p>#以下是模块信息，我们可以创建多个模块</p>
<p>#MODULE OPTIONS</p>
<p>[ftp]</p>
<p>comment = public archive #模块描述</p>
<p>path = /var/www/pub #需要同步的路径</p>
<p>use chroot = yes #默认是yes|true，如果为true，那么在rsync在传输文件以前首先chroot到path参数指定的目录下。这样做的原因是实现额外的安全防护，但是缺点是需要root权限，并且不能备份指向外部的符号连接指向的目录文件。</p>
<p>#max connections=10 #最大连接数</p>
<p>lock file = /var/lock/rsyncd #指定支持max connections参数的锁文件。</p>
<p>#the default for read only is yes<br>read only = yes #只读选项</p>
<p>list = yes #客户请求时可用模块时是否列出该模块</p>
<p>uid = nobody #设定该模块传输文件时守护进程应该具有的uid</p>
<p>gid = nogroup #设定该模块传输文件时守护进程应具有的gid，此项与uid配合可以确定文件的访问权限</p>
<p>#exclude = #用来指定多个由空格隔开的多个模式列表，并将其添加到exclude列表中。这等同于在客户端命令中使用–exclude来指定模式，不过配置文件中指定的exlude模式不会传递给客户端，而仅仅应用于服务器。一个模块只能指定一个exlude选项，但是可以在模式前面使用”-“和”+”来指定是exclude还是include    #这个我的理解是排除目录中不需同步的文件</p>
<p>#exclude from = #可以指定一个包含exclude模式定义的文件名</p>
<p>#include = #与exclude相似</p>
<p>#include from = #可以指定一个包含include模式定义的文件名</p>
<p>#auth users = #该选项指定由空格或逗号分隔的用户名列表，只有这些用户才允许连接该模块。这里的用户和系统用户没有任何关系。如果”auth users”被设置，那么客户端发出对该模块的连接请求以后会被rsync请求challenged进行验证身份这里使用的 challenge/response认证协议。用户的名和密码以明文方式存放在”secrets file”选项指定的文件中。默认情况下无需密码就可以连接模块(也就是匿名方式)</p>
<p>#secrets file =/etc/rsyncd.secrets #该文件每行包含一个username:password对，以明文方式存储，只有在auth users被定义时，此选项才生效。同时我们需要将此文件权限设置为0600</p>
<p>strict modes = yes #该选项指定是否监测密码文件的权限，如果该选项值为true那么密码文件只能被rsync服务器运行身份的用户访问，其他任何用户不可以访问该文件。默认值为true</p>
<p>#hosts allow = #允许的主机</p>
<p>#hosts deny = #拒绝访问的主机</p>
<p>ignore errors = no #设定rsync服务器在运行delete操作时是否忽略I/O错误</p>
<p>ignore nonreadable = yes #设定rysnc服务器忽略那些没有访问文件权限的用户</p>
<p>transfer logging = no #使rsync服务器使用ftp格式的文件来记录下载和上载操作在自己单独的日志中</p>
<p>#log format = %t: host %h (%a) %o %f (%l bytes). Total %b bytes. #设定日志格式<br>timeout = 600 #超时设置(秒)</p>
<p>refuse options = checksum dry-run #定义一些不允许客户对该模块使用的命令选项列表</p>
<p>dont compress = <em>.gz </em>.tgz <em>.zip </em>.z <em>.rpm </em>.deb <em>.iso </em>.bz2 *.tbz #告诉rysnc那些文件在传输前不用压缩，默认已设定压缩包不再进行压缩</p>
</blockquote>
<p>然后定义自己的conf文件</p>
<p><img src="https://raw.githubusercontent.com/puede/tupian/master/1.jpg" alt="rsyncd.conf"></p>
<p>配置完之后,ESC :wq保存退出</p>
<ol>
<li>创建一个密码文件<br><img src="https://raw.githubusercontent.com/puede/tupian/master/2.jpg" alt="rsyncd.secrets"></li>
</ol>
<p>$sudo vi /etc/rsyncd.secrets</p>
<p>写入 ursy:123</p>
<p>$sudo chmod 0600 /etc/rsyncd.secrets    </p>
<ol>
<li>启动rsync</li>
</ol>
<p>sudo /etc/init.d/rsync start</p>
<h3 id="三-客户端"><a href="#三-客户端" class="headerlink" title="三. 客户端"></a>三. 客户端</h3><p>我们再来看一下客户端的操作，一般客户端不需要进行特殊的配置，直接同步即可.</p>
<ol>
<li>安装rsync</li>
</ol>
<p>将下载的客户端rsync解压安装在本地,另外必须配置环境变量</p>
<ol>
<li>创建一个密码文件<br>$vi tbu/rsync.pwd 输入123，保存 密码要与服务器端设置的一致</li>
</ol>
<p>chmod 0600 tbu/rsync.pwd</p>
<p>chown 普通用户:普通用户组 tbu/rsync.pwd</p>
<ol>
<li>测试服务器rsync的连通性</li>
</ol>
<p><img src="https://raw.githubusercontent.com/puede/tupian/master/4.jpg" alt="telnet"></p>
<p>出现@RSYNCD: 31.0 等类似文字，则说明客户端连接服务端正常。</p>
<p><img src="https://raw.githubusercontent.com/puede/tupian/master/5.jpg" alt="telnet"></p>
<h3 id="四-同步文件"><a href="#四-同步文件" class="headerlink" title="四. 同步文件"></a>四. 同步文件</h3><p>双向</p>
<p>rsync -avzP . root@111.111.111.111:/var/www</p>
<p> rsync -avzP src root@111.111.111.111:des</p>
<p>想同步到哪 就在那个目录下面cmder</p>
<p>同步线上的/var/www 目录到本地etc/目录下</p>
<p>rsync -avz root@111.111.111.111:/var/www  tbu/  </p>
<p><img src="https://raw.githubusercontent.com/puede/tupian/master/6.jpg" alt="tongbu">             </p>
<h3 id="五-Rsync命令详解"><a href="#五-Rsync命令详解" class="headerlink" title="五. Rsync命令详解"></a>五. Rsync命令详解</h3><p>Rsync的命令格式可以为以下六种：</p>
<p>　　rsync [OPTION]… SRC DEST</p>
<p>　　rsync [OPTION]… SRC [USER@]HOST:DEST</p>
<p>　　rsync [OPTION]… [USER@]HOST:SRC DEST</p>
<p>　　rsync [OPTION]… [USER@]HOST::SRC DEST</p>
<p>　　rsync [OPTION]… SRC [USER@]HOST::DEST</p>
<p>　　rsync [OPTION]… rsync://[USER@]HOST[:PORT]/SRC [DEST]</p>
<p>　　<br>对应于以上六种命令格式，rsync有六种不同的工作模式：</p>
<p>　　(1)拷贝本地文件。当SRC和DES路径信息都不包含有单个冒号”:“分隔符时就启动这种工作模式。</p>
<p>如：rsync -a /data /backup</p>
<p>　　(2)使用一个远程shell程序(如rsh、ssh)来实现将本地机器的内容拷贝到远程机器。当DST路径地址包含单个冒号”:“分隔符时启动 该模式。</p>
<p>如：rsync -avz *.c foo:src</p>
<p>　　(3)使用一个远程shell程序(如rsh、ssh)来实现将远程机器的内容拷贝到本地机器。当SRC地址路径包含单个冒号”:“分隔符时启动 该模式。</p>
<p>如：rsync -avz foo:src/bar /data</p>
<p>　　(4)从远程rsync服务器中拷贝文件到本地机。当SRC路径信息包含”::“分隔符时启动该模式。</p>
<p>如：rsync -av root@172.16.78.192::www /databack</p>
<p>　　(5)从本地机器拷贝文件到远程rsync服务器中。当DST路径信息包含”::“分隔符时启动该模式。</p>
<p>如：rsync -av /databack root@172.16.78.192::www</p>
<p>　　(6)列远程机的文件列表。这类似于rsync传输，不过只要在命令中省略掉本地机信息即可。</p>
<p>如：rsync -v rsync://172.16.78.192/www</p>
<h3 id="六-部分错误的解决办法"><a href="#六-部分错误的解决办法" class="headerlink" title="六. 部分错误的解决办法"></a>六. 部分错误的解决办法</h3><p>1.’rsync’ 不是内部或外部命令，也不是可运行的程序或批处理文件。<br>加环境变量<br>path = e:\Program Files (x86)\cwRsync\bin</p>
<p>2.rsync: failed to connect to 192.168.7.20: Connection timed out (116)<br>rsync error: error in socket IO (code 10) at clientserver.c(122) [Receiver=3.0.7]<br>网络通畅，服务器端允许访问端口 873</p>
<p>3.@ERROR: invalid uid nobody<br>rsync error: error starting client-server protocol (code 5) at main.c(1506) [Receiver=3.0.7]<br>指定uid gid<br>uid = 0<br>gid = 0</p>
<p>4.@ERROR: chdir failed<br>rsync error: error starting client-server protocol (code 5) at main.c(1506) [Receiver=3.0.7]<br>path目录配置的正确，得存在<br>解决：服务器端同步目录没有权限，cwrsync默认用户是Svcwrsync。为同步目录添加用户Svcwrsync权限。<br>也可以通过 菜单–cwRsyncServer–02. Prep a Dir for Upload 配置目录权限<br>除完全控制和特殊权限外的所有权限</p>
<p>5.@ERROR: auth failed on module test<br>rsync error: error starting client-server protocol (code 5) at main.c(1506) [Receiver=3.0.7]<br>客户端设置<br>a.在命令上要指定好用户名<br>b.密码文件只写密码<br>rsyncd.secrets文件<br>rsyncpass<br>c.用户名密码都要正确</p>
<p>6.Unexpected local arg: /cygdrive/d/rsyncBackup<br>If arg is a remote file/dir, prefix it with a colon (:).<br>rsync error: syntax or usage error (code 1) at main.c(1218) [Receiver=3.0.7]<br>不一定是这个路径有问题，可能是–password-file路径中有空格，服务器端没问题，客户端好像不行</p>
<p>7.password file must be owned by root when running as root<br>continuing without password file<br>Password:<br>设置密码访问权限chown.exe可从服务器端拷贝过来<br>chmod -c 600 /cygdrive/c/etc/rsyncd.secrets<br>chown administrator /cygdrive/c/etc/rsyncd.secrets<br>服务器端不设也可以</p>
<p>### </p>
<ol>
<li><p>将dirA的所有文件同步到dirB内，并删除dirB内多余的文件</p>
<p>$ rsync -avz –delete  dirA/ dirB/</p>
</li>
</ol>
<ol>
<li>将dirA的所有文件同步到dirB，但是在dirB内除了fileB3.txt这个文件不删之外，其他的都删除。</li>
</ol>
<p>$ rsync -avz –delete –exclude “fileB3.txt”  dirA/  dirB/</p>
<ol>
<li>将dirA目录内的fileA1.txt和fileA2.txt不同步到dirB目录内。</li>
</ol>
<p>$ rsync -avz –exclude=”fileA1.txt” –exclude=”fileA2.txt” dirA/ dirB/</p>
<ol>
<li>将dirA目录内的fileA1.txt和fileA2.txt不同步到dirB目录内，并且在dirB目录内删除多余的文件。</li>
</ol>
<p>$ rsync -avz –exclude=”fileA1.txt” –exclude=”fileA2.txt” –delete  dirA/ dirB/</p>
<ol>
<li>将dirA目录内的fileA1.txt和fileA2.txt不同步到dirB目录内，并且在dirB目录内删除多余的文件，同时，如果dirB内有fileA2.txt和fileA1.txt这两个被排除同步的文件，仍然将其删除。</li>
</ol>
<p>$ rsync -avz –exclude=”fileA1.txt” –exclude=”fileA2.txt”  –delete-excluded  dirA/ dirB/</p>
<p>rsyncd.conf</p>
<p>#sample rsyncd.conf configuration file  </p>
<p>#GLOBAL OPTIONS  </p>
<p>#motd file=/etc/motd<br>log file=/var/log/rsyncd  </p>
<p>#for pid file, do not use /var/run/rsync.pid if  </p>
<p>#you are going to run rsync out of the init.d script.<br> pid file=/var/run/rsyncd.pid<br>syslog facility=daemon  </p>
<p>#socket options=  </p>
<p>#MODULE OPTIONS<br>[my_rsync_bk] #名字可以任意命名，只要客户端的rsync命令一致<br>        port = 873<br>        comment = public archive<br>        path = /my_rsync_bk   #指定路径，如果没有这个目录自己建。<br>        use chroot = no  </p>
<pre><code>#max connections=10  
lock file = /var/lock/rsyncd  
#the default for read only is yes...  
read only = yes  
list = yes  
uid = nobody  
gid = nogroup  
#exclude =   
#exclude from =   
#include =  
#include from =  
auth users = ursy   #rsync连接时的用户名，要和客户端rsync的命令一致  
secrets file = /etc/rsyncd.secrets #这里是保存密码的地方，如果屏蔽掉就不用密码了  
strict modes = yes  
hosts allow = 192.168.7.20 111.111.111.111 123.160.246.142 #运行的客户端ip  
#hosts deny =  
ignore errors = yes  
ignore nonreadable = yes  
transfer logging = yes  
log format = %t: host %h (%a) %o %f (%l bytes). Total %b bytes.  
timeout = 600  
refuse options = checksum dry-run  
dont compress = *.gz *.tgz *.zip *.z *.rpm *.deb *.iso *.bz2 *.tbz  
</code></pre>  
	</div>
		<footer class="article-footer clearfix">




<div class="article-share" id="share">

  <div data-url="http://yoursite.com/2018/01/27/Ubuntu Server Rsync服务端与Windows cwRsync客户端实现数据同步配置/" data-title="Ubuntu Server Rsync服务端与Windows cwRsync客户端实现数据同步配置 | yangxc" data-tsina="" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/2018/01/27/test/"  title="Ubuntu Server Rsync服务端与Windows cwRsync客户端实现数据同步配置">
 <strong>NEXT:</strong><br/> 
 <span>Ubuntu Server Rsync服务端与Windows cwRsync客户端实现数据同步配置
</span>
</a>
</div>

</nav>

	
</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#一-需要的工具"><span class="toc-number">1.</span> <span class="toc-text">一. 需要的工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#二-服务器端"><span class="toc-number">2.</span> <span class="toc-text">二. 服务器端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#三-客户端"><span class="toc-number">3.</span> <span class="toc-text">三. 客户端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#四-同步文件"><span class="toc-number">4.</span> <span class="toc-text">四. 同步文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#五-Rsync命令详解"><span class="toc-number">5.</span> <span class="toc-text">五. Rsync命令详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#六-部分错误的解决办法"><span class="toc-number">6.</span> <span class="toc-text">六. 部分错误的解决办法</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  

  <div class="rsspart">
	<a href="/atom.xml## RSS address." target="_blank" title="rss">RSS 订阅</a>
</div>

  

  

  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
      <li><a href="http://blog.leafh.pw" target="_blank" title="Leaf Hsiao">Leaf's Blog</a></li>
      <li><a href="http://hexo.io" target="_blank" title="Hexo">Hexo</a></li>
    </ul>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font clearfix">
		
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://zespia.tw/hexo/" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/leaf-hsiao/catman" target="_blank" title="Catman">Catman</a> © 2018 
		
		<a href="http://yoursite.com" target="_blank" title="perla">perla</a>
		
		</p>
</div>
</footer>
    <div id="top" style="position:fixed;bottom:100px;right:30px;cursor: pointer;">
        <a title="top"><img src="/img/top.png"/ width="50px"></a>
    </div>
    <script src="http://cdn.bootcss.com/jquery/2.1.3/jquery.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,208-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      m = $('#main'),
      a = $('#asidepart'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside'),
      w  = $(window).width();
  if ( w>1070 ) {
  	m.addClass('moveMain');
  	a.css('display', 'none').addClass('fadeIn');
  	o.css('display', 'block');
  };
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
  	if ( w>1070 ) {
  	  ta.css('display', 'block').addClass('fadeIn');
  	};
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,250-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>
<script type="text/javascript">
  (function($) {
  var upperLimit = 1000;
  var scrollElem = $('#top');
  var scrollSpeed = 500;
  scrollElem.hide();
  $(window).scroll(function () {
  var scrollTop = $(document).scrollTop();
  if ( scrollTop > upperLimit ) {
  $(scrollElem).stop().fadeTo(300, 1);
  }
  else{
    $(scrollElem).stop().fadeTo(300, 0);
  }
});
$(scrollElem).click(function(){
$('html, body').animate({scrollTop:0}, scrollSpeed); return false;
});
})(jQuery);
</script> 






  </body>
</html>
