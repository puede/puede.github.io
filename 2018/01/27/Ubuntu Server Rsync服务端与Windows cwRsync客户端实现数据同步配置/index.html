<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Ubuntu Server Rsync服务端与Windows cwRsync客户端实现数据同步配置 | lyyourc</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="/css/app.css">
  <!-- <link rel='stylesheet' href='http://fonts.useso.com/css?family=Source+Code+Pro'> -->
  
</head>

<body>
  <nav class="app-nav">
  
    
      <a href="/.">home</a>
    
  
    
      <a href="/archives">archive</a>
    
  
    
      <a href="/atom.xml">rss</a>
    
  
</nav>

  <main class="post">
  <article>
  <h1 class="article-title">
    <a href="/2018/01/27/Ubuntu Server Rsync服务端与Windows cwRsync客户端实现数据同步配置/">Ubuntu Server Rsync服务端与Windows cwRsync客户端实现数据同步配置</a>
  </h1>

  <section class="article-meta">
    <p class="article-date">一月 27 2018</p>
  </section>

  <section class="article-entry">
    <p>Rsync(remote synchronize)是一个远程数据同步工具，可以使用“Rsync算法”同步本地和远程主机之间的文件。rsync的好处是只同步两个文件不同的部分，相同的部分不在传递。类似于增量备份，这使的在服务器传递备份文件或者同步文件，比起scp工具要省好多时间</p>
<h3 id="一-需要的工具"><a href="#一-需要的工具" class="headerlink" title="一. 需要的工具"></a>一. 需要的工具</h3><p>下载cwRsyncServer服务器端与客户端的安装文件：</p>
<p>服务端下载：<a href="https://pan.baidu.com/share/link?shareid=901516432&amp;uk=118355419" title="服务端下载" target="_blank" rel="noopener">cwRsyncServer_4.0.5_Installer.zip</a></p>
<p>客户端下载：<a href="https://pan.baidu.com/share/link?shareid=903891290&amp;uk=118355419" target="_blank" rel="noopener">cwRsync_4.0.5_Installer.zip</a></p>
<p>server:122.152.193.160</p>
<p>client:192.168.7.20</p>
<h3 id="二-服务器端"><a href="#二-服务器端" class="headerlink" title="二. 服务器端"></a>二. 服务器端</h3><ol>
<li><p>ubuntu server 默认已安装rsync，但是rsync服务默认不是启动的，我们要修改下面的文件$sudo vi /etc/default/rsync<br>RSYNC_ENABLE=false    #false改true</p>
</li>
<li><p>修改配置文件/etc/rsyncd.conf</p>
</li>
</ol>
<p>我们先来查看一下这个文件<br>$sudo cat /etc/rsyncd.conf</p>
<blockquote>
<p> #sample rsyncd.conf configuration file</p>
<p>#GLOBAL OPTIONS</p>
<p>#motd file=/etc/motd #登录欢迎信息</p>
<p>#log file=/var/log/rsyncd #日志文件</p>
<p>#for pid file, do not use &gt;/var/run/rsync.pid if</p>
<p>#you are going to run rsync out of the init.d script.<br>pid file=/var/run/rsyncd.pid #进程编号</p>
<p>#指定rsync发送日志消息给syslog时的消息级别，常见的消息级别是：uth, authpriv, cron, daemon, ftp, kern, lpr, mail, news, security, sys-log, user, uucp, local0, local1, local2, local3,local4, local5, local6和local7。默认值是daemon。</p>
<p>#syslog facility=daemon #执行系统日志记录活动</p>
<p>#自定义tcp选项，默认是关闭的</p>
<p>#socket options=</p>
<p>#以下是模块信息，我们可以创建多个模块</p>
<p>#MODULE OPTIONS</p>
<p>[ftp]</p>
<p>comment = public archive #模块描述</p>
<p>path = /var/www/pub #需要同步的路径</p>
<p>use chroot = yes #默认是yes|true，如果为true，那么在rsync在传输文件以前首先chroot到path参数指定的目录下。这样做的原因是实现额外的安全防护，但是缺点是需要root权限，并且不能备份指向外部的符号连接指向的目录文件。</p>
<p>#max connections=10 #最大连接数</p>
<p>lock file = /var/lock/rsyncd #指定支持max connections参数的锁文件。</p>
<p>#the default for read only is yes<br>read only = yes #只读选项</p>
<p>list = yes #客户请求时可用模块时是否列出该模块</p>
<p>uid = nobody #设定该模块传输文件时守护进程应该具有的uid</p>
<p>gid = nogroup #设定该模块传输文件时守护进程应具有的gid，此项与uid配合可以确定文件的访问权限</p>
<p>#exclude = #用来指定多个由空格隔开的多个模式列表，并将其添加到exclude列表中。这等同于在客户端命令中使用–exclude来指定模式，不过配置文件中指定的exlude模式不会传递给客户端，而仅仅应用于服务器。一个模块只能指定一个exlude选项，但是可以在模式前面使用”-“和”+”来指定是exclude还是include    #这个我的理解是排除目录中不需同步的文件</p>
<p>#exclude from = #可以指定一个包含exclude模式定义的文件名</p>
<p>#include = #与exclude相似</p>
<p>#include from = #可以指定一个包含include模式定义的文件名</p>
<p>#auth users = #该选项指定由空格或逗号分隔的用户名列表，只有这些用户才允许连接该模块。这里的用户和系统用户没有任何关系。如果”auth users”被设置，那么客户端发出对该模块的连接请求以后会被rsync请求challenged进行验证身份这里使用的 challenge/response认证协议。用户的名和密码以明文方式存放在”secrets file”选项指定的文件中。默认情况下无需密码就可以连接模块(也就是匿名方式)</p>
<p>#secrets file =/etc/rsyncd.secrets #该文件每行包含一个username:password对，以明文方式存储，只有在auth users被定义时，此选项才生效。同时我们需要将此文件权限设置为0600</p>
<p>strict modes = yes #该选项指定是否监测密码文件的权限，如果该选项值为true那么密码文件只能被rsync服务器运行身份的用户访问，其他任何用户不可以访问该文件。默认值为true</p>
<p>#hosts allow = #允许的主机</p>
<p>#hosts deny = #拒绝访问的主机</p>
<p>ignore errors = no #设定rsync服务器在运行delete操作时是否忽略I/O错误</p>
<p>ignore nonreadable = yes #设定rysnc服务器忽略那些没有访问文件权限的用户</p>
<p>transfer logging = no #使rsync服务器使用ftp格式的文件来记录下载和上载操作在自己单独的日志中</p>
<p>#log format = %t: host %h (%a) %o %f (%l bytes). Total %b bytes. #设定日志格式<br>timeout = 600 #超时设置(秒)</p>
<p>refuse options = checksum dry-run #定义一些不允许客户对该模块使用的命令选项列表</p>
<p>dont compress = <em>.gz </em>.tgz <em>.zip </em>.z <em>.rpm </em>.deb <em>.iso </em>.bz2 *.tbz #告诉rysnc那些文件在传输前不用压缩，默认已设定压缩包不再进行压缩</p>
</blockquote>
<p>然后定义自己的conf文件</p>
<p><img src="https://raw.githubusercontent.com/puede/tupian/master/1.jpg" alt="rsyncd.conf"></p>
<p>配置完之后,ESC :wq保存退出</p>
<ol>
<li>创建一个密码文件<br><img src="https://raw.githubusercontent.com/puede/tupian/master/2.jpg" alt="rsyncd.secrets"></li>
</ol>
<p>$sudo vi /etc/rsyncd.secrets</p>
<p>写入 ursy:123</p>
<p>$sudo chmod 0600 /etc/rsyncd.secrets    </p>
<ol>
<li>启动rsync</li>
</ol>
<p>sudo /etc/init.d/rsync start</p>
<h3 id="三-客户端"><a href="#三-客户端" class="headerlink" title="三. 客户端"></a>三. 客户端</h3><p>我们再来看一下客户端的操作，一般客户端不需要进行特殊的配置，直接同步即可.</p>
<ol>
<li>安装rsync</li>
</ol>
<p>将下载的客户端rsync解压安装在本地,另外必须配置环境变量</p>
<ol>
<li>创建一个密码文件<br>$vi tbu/rsync.pwd 输入123，保存 密码要与服务器端设置的一致</li>
</ol>
<p>chmod 0600 tbu/rsync.pwd</p>
<p>chown 普通用户:普通用户组 tbu/rsync.pwd</p>
<ol>
<li>测试服务器rsync的连通性</li>
</ol>
<p><img src="https://raw.githubusercontent.com/puede/tupian/master/4.jpg" alt="telnet"></p>
<p>出现@RSYNCD: 31.0 等类似文字，则说明客户端连接服务端正常。</p>
<p><img src="https://raw.githubusercontent.com/puede/tupian/master/5.jpg" alt="telnet"></p>
<h3 id="四-同步文件"><a href="#四-同步文件" class="headerlink" title="四. 同步文件"></a>四. 同步文件</h3><p>想同步到哪 就在那个目录下面cmder</p>
<p>同步线上的/var/www 目录到本地etc/目录下</p>
<p>rrsync -avz root@122.152.193.160:/var/www  tbu/                                        </p>
<p><img src="https://raw.githubusercontent.com/puede/tupian/master/6.jpg" alt="tongbu">             </p>

  </section>
</article>

  <div class="sharing grid">
  <section class="profile grid-item grid">
    <img class="avatar" src="http://7xrcp8.com1.z0.glb.clouddn.com/avatar.png" alt="avatar" />
    <div class="grid-item">
      <p class="title"> lyyourc </p>
      <p class="subtitle"> You Are The JavaScript In My HTML </p>
    <div>
  </section>

  <section class="share-btns">
    <!-- <p> share it if you like it~ </p> -->
    <a
  class="twitter-share-button"
  data-size="large"
  data-via="DrakeLeung"
  href="https://twitter.com/intent/tweet?text=Rsync(remote synchro"
>
  Tweet
</a>

<script>
  window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return t;
  js = d.createElement(s);
  js.id = id;
  js.src = "https://platform.twitter.com/widgets.js";
  js.async = true;
  fjs.parentNode.insertBefore(js, fjs);

  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };

  return t;
}(document, "script", "twitter-wjs"));
</script>

  </section>
</div>


  
    
<section class="article-comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

<script>
  var disqus_shortname = 'drakeleung';
  
  var disqus_url = 'http://localhost:4000/2018/01/27/Ubuntu Server Rsync服务端与Windows cwRsync客户端实现数据同步配置/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


  
</main>

</body>
</html>
